<%@ page language="java" pageEncoding="UTF-8" %>
<jsp:include page="../inc/header.jsp"></jsp:include>
<div id='main'>
    <jsp:include page="../inc/sidebar.jsp"></jsp:include>
    <div id='content'>
        <div class='panel'>
            <div class='header topic_header'>
                <h1 class="topic_full_title">${topic.title}</h1>
                <div class="changes">
                    <span>${topic.friendlyTime}</span><span>&nbsp;&nbsp;作者：<a href="/user/abc1231hahaha">${topic.authorName}</a></span><span>&nbsp;&nbsp; ${topic.visitCount}次浏览</span>
                </div>
            </div>
            <div class='inner topic'>
                <div class="topic_content">
                    <div class="editormd-preview-container">
                       ${topic.contentHTML}
                    </div>
                </div>
            </div>
        </div>
        <div class="panel">
            <div class="header">
                <span class="col_fade">5 回复</span>
            </div>
            <div class="cell reply_area reply_item" reply_id="5975655d0c87675e746747c5" reply_to_id="" id="5975655d0c87675e746747c5">
                <div class="author_content">
                    <a href="/user/captainblue2013" class="user_avatar">
                        <img src="https://avatars1.githubusercontent.com/u/3942299?v=4&amp;s=120" title="captainblue2013"></a>
                    <div class="user_info">
                        <a class="dark reply_author" href="/user/captainblue2013">captainblue2013</a>
                        <a class="reply_time" href="#5975655d0c87675e746747c5">1楼•1 个月前</a>
                    </div>
                    <div class="user_action">
                      <span>
                        <i class="fa up_btn
                          fa-thumbs-o-up
                          invisible" title="喜欢"></i>
                        <span class="up-count">

                        </span>
                      </span>

                        <span></span>
                    </div>
                </div>
                <div class="reply_content from-captainblue2013">
                    <div class="markdown-text"><p>鬼扯</p>
                    </div>
                </div>
                <div class="clearfix">
                    <div class="reply2_area">

                    </div>
                </div>
            </div>
            <div class="cell reply_area reply_item" reply_id="5975660e3f0ab31540ed4cd3" reply_to_id="5975655d0c87675e746747c5" id="5975660e3f0ab31540ed4cd3">
                <div class="author_content">
                    <a href="/user/18820227745" class="user_avatar">
                        <img src="https://avatars0.githubusercontent.com/u/25097125?v=4&amp;s=120" title="18820227745"></a>
                    <div class="user_info">
                        <a class="dark reply_author" href="/user/18820227745">18820227745</a>
                        <a class="reply_time" href="#5975660e3f0ab31540ed4cd3">2楼•1 个月前</a>
                        <span class="reply_by_author">作者</span>
                    </div>
                    <div class="user_action">
                      <span>
                        <i class="fa up_btn
                          fa-thumbs-o-up
                          invisible" title="喜欢"></i>
                        <span class="up-count"></span>
                      </span>
                      <span></span>
                    </div>
                </div>
                <div class="reply_content from-18820227745">
                    <div class="markdown-text"><p><a href="/user/captainblue2013" target="_blank">@captainblue2013</a> 有没有更好的学习路线，纠正我一下呗</p>
                    </div>
                </div>
                <div class="clearfix">
                    <div class="reply2_area">

                    </div>
                </div>
            </div>
            <div class="cell reply_area reply_item" reply_id="59a3b0139e95202d08c91d11" reply_to_id="" id="59a3b0139e95202d08c91d11">
                <div class="author_content">
                    <a href="/user/Surile" class="user_avatar">
                        <img src="https://avatars0.githubusercontent.com/u/28652894?v=4&amp;s=120" title="Surile"></a>
                    <div class="user_info">
                        <a class="dark reply_author" href="/user/Surile">Surile</a>
                        <a class="reply_time" href="#59a3b0139e95202d08c91d11">3楼•9 小时前</a>
                    </div>
                    <div class="user_action">
                      <span>
                        <i class="fa up_btn
                          fa-thumbs-o-up
                          invisible" title="喜欢"></i>
                        <span class="up-count"></span>
                      </span>
                      <span></span>
                    </div>
                </div>
                <div class="reply_content from-Surile">
                    <div class="markdown-text"><p>我觉得不错，我也准备按照这个来学习</p>
                    </div>
                </div>
                <div class="clearfix">
                    <div class="reply2_area">

                    </div>
                </div>
            </div>
            <div class="cell reply_area reply_item" reply_id="59a3b13cd97b7e23082427d0" reply_to_id="" id="59a3b13cd97b7e23082427d0">
                <div class="author_content">
                    <a href="/user/KingTree" class="user_avatar">
                        <img src="https://avatars1.githubusercontent.com/u/10388282?v=4&amp;s=120" title="KingTree"></a>
                    <div class="user_info">
                        <a class="dark reply_author" href="/user/KingTree">KingTree</a>
                        <a class="reply_time" href="#59a3b13cd97b7e23082427d0">4楼•9 小时前</a>
                    </div>
                    <div class="user_action">
                      <span>
                        <i class="fa up_btn
                          fa-thumbs-o-up
                          invisible" title="喜欢"></i>
                        <span class="up-count"></span>
                      </span>
                        <span></span>
                    </div>
                </div>
                <div class="reply_content from-KingTree">
                    <div class="markdown-text"><p>mark</p></div>
                </div>
                <div class="clearfix">
                    <div class="reply2_area"></div>
                </div>
            </div>
            <div class="cell reply_area reply_item" reply_id="59a3c017bc6d9537081288e2" reply_to_id="" id="59a3c017bc6d9537081288e2">
                <div class="author_content">
                    <a href="/user/lzh1104" class="user_avatar">
                        <img src="https://avatars3.githubusercontent.com/u/663128?v=4&amp;s=120" title="lzh1104"></a>
                    <div class="user_info">
                        <a class="dark reply_author" href="/user/lzh1104">lzh1104</a>
                        <a class="reply_time" href="#59a3c017bc6d9537081288e2">5楼•8 小时前</a>
                    </div>
                    <div class="user_action">
                      <span>
                        <i class="fa up_btn
                          fa-thumbs-o-up
                          invisible" title="喜欢"></i>
                        <span class="up-count"></span>
                      </span>
                      <span></span>
                    </div>
                </div>
                <div class="reply_content from-lzh1104">
                    <div class="markdown-text"><p>我不明白为何 nodejs学习资料上要来个 express?</p>
                    </div>
                </div>
                <div class="clearfix">
                    <div class="reply2_area"></div>
                </div>
            </div>
        </div>
        <div id="reply">
            <form action="/comment/${topic.id}" method="post" class="form-vertical" id="reply-form" role="form">
                <fieldset>
                    <div class="form-group">
                        <label>新回复</label>
                        <div id="editormd">
                            <textarea style="display: none;"></textarea>
                        </div>
                    </div>
                    <input type="submit" class="btn btn-primary" value="回复" id="submit">
                </fieldset>
            </form>
        </div>
    </div>
</div>
<jsp:include page="../inc/footer.jsp"></jsp:include>
<script>
    var editor, editor_edit;
    $(document).ready(function(){
        $('#submit').attr('disabled', true);

        editor = createEditorMd("editormd", "#submit");

        $('.editormd-preview-container pre').addClass("prettyprint linenums");
        prettyPrint();
    });

    /**
     * 创建Markdown编辑器封装方法
     * @param divId
     * @param submitId
     * @param markdown
     * @returns {*}
     */
    function createEditorMd(divId, submitId, markdown) {
        var editor = editormd(divId, {
            height           : 300,
            markdown         : markdown,
            tex              : true,
            tocm             : true,
            emoji            : true,
            taskList         : true,
            codeFold         : true,
            searchReplace    : true,
            htmlDecode       : "style,script,iframe",
            flowChart        : true,
            sequenceDiagram  : true,
            autoFocus: false,
            path: "${contextPath}/js/editormd/lib/",
            placeholder: "Markdown，提交前请查看预览格式是否正确",
            saveHTMLToTextarea: true,
            imageUpload: true,
            imageFormats: ["jpg", "jpeg", "gif", "png"],
            imageUploadURL: "${contextPath}/upload/image",
            toolbarIcons: function() {
                return ["undo", "redo", "|", "bold", "italic", "quote", "|",
                    "h1", "h2", "h3", "h4", "h5", "h6", "|",
                    "list-ul", "list-ol", "hr", "|",
                    "link", "reference-link", "image", "code", "preformatted-text", "code-block", "|",
                    "goto-line", "watch", "preview", "fullscreen", "|",
                    "help", "info"]
            },
            onfullscreen : function() {
                this.editor.css("border-radius", 0).css("z-index", 120);
            },
            onfullscreenExit : function() {
                this.editor.css({
                    zIndex : 10,
                    border : "none",
                    "border-radius" : "5px"
                });

                this.resize();
            },
            onchange: function() {
                $(submitId).attr('disabled', this.getMarkdown().trim() == "");
            }
        });

        return editor;
    }
</script>
